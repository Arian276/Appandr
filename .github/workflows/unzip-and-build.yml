name: Unzip BarrileteCosmicTV.zip

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - 'BarrileteCosmicTV.zip'

permissions:
  contents: write

jobs:
  unzip:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Verificar que el zip exista
        run: |
          test -f BarrileteCosmicTV.zip || { echo "‚ùå No est√° BarrileteCosmicTV.zip en la ra√≠z"; exit 1; }

      - name: Limpiar ra√≠z (menos .git, .github y el zip)
        run: |
          shopt -s extglob dotglob
          rm -rf !(.git|.github|BarrileteCosmicTV.zip)

      - name: Descomprimir y mover TODO a la ra√≠z
        run: |
          unzip -q BarrileteCosmicTV.zip -d extracted
          ROOT_DIR=$(find extracted -mindepth 1 -maxdepth 1 -type d | head -n1)
          echo "üì¶ Carpeta detectada: $ROOT_DIR"
          shopt -s dotglob
          mv "$ROOT_DIR"/* .
          rm -rf extracted BarrileteCosmicTV.zip
          echo "üìÇ Archivos en ra√≠z ahora:"
          ls -la

      - name: Commit resultado
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Unzip completo BarrileteCosmicTV.zip" || echo "Sin cambios"
          git push || true
