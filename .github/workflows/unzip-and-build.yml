name: Unzip BarrileteCosmicTV.zip

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - 'BarrileteCosmicTV.zip'

permissions:
  contents: write

jobs:
  unzip:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - name: Verificar ZIP
        run: |
          test -f BarrileteCosmicTV.zip || { echo "‚ùå Falta BarrileteCosmicTV.zip"; exit 1; }

      - name: Limpiar ra√≠z (mantener .git, .github y el ZIP)
        run: |
          shopt -s extglob dotglob
          rm -rf !(.git|.github|BarrileteCosmicTV.zip)

      - name: Descomprimir y mover TODO a la ra√≠z
        run: |
          set -euo pipefail
          unzip -q BarrileteCosmicTV.zip -d extracted
          shopt -s dotglob
          # Si el ZIP tiene exactamente UNA carpeta contenedora y NADA m√°s, usarla.
          if [ "$(find extracted -mindepth 1 -maxdepth 1 | wc -l)" -eq 1 ] && [ -d extracted/* ]; then
            SRC=$(find extracted -mindepth 1 -maxdepth 1 -type d -print -quit)
          else
            # Caso t√≠pico: el ZIP ya trae app/, gradle/, gradlew, etc. en su ra√≠z
            SRC="extracted"
          fi
          rsync -a "$SRC"/ ./ --exclude='.git' --exclude='.github'
          rm -rf extracted BarrileteCosmicTV.zip
          echo "üìÇ Contenido final:"
          ls -la

      - name: Commit resultado
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add -A
          git commit -m "Unzip completo a la ra√≠z" || echo "Sin cambios"
          git push || true
